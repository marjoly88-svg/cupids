<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cupids - ãƒãƒ£ãƒƒãƒˆå ã„</title>
  
  <!-- PWAè¨­å®š -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#ec4899">
  <meta name="description" content="æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡">
  
  <!-- Appleç”¨ã‚¢ã‚¤ã‚³ãƒ³ -->
  <link rel="apple-touch-icon" href="./cupids_icon_192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Cupids">
  
  <!-- Androidã‚¢ã‚¤ã‚³ãƒ³ -->
  <link rel="icon" type="image/png" sizes="192x192" href="./cupids_icon_192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./cupids_icon_512.png">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    * {
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- React & ReactDOM & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyA52uJ31HzLkbz32lA-3WWSmhM10xYjjCg",
      authDomain: "cupids-chat.firebaseapp.com",
      projectId: "cupids-chat",
      storageBucket: "cupids-chat.firebasestorage.app",
      messagingSenderId: "44532110483",
      appId: "1:44532110483:web:d6266e8abba8582b8b6966"
    };

    // FirebaseåˆæœŸåŒ–
    firebase.initializeApp(firebaseConfig);

    function CupidsApp() {
      const [currentUser, setCurrentUser] = useState(null);
      const [screen, setScreen] = useState('login');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [loading, setLoading] = useState(true);
      const [name, setName] = useState('');
      const [userType, setUserType] = useState('client');

      // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
      useEffect(() => {
        const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            firebase.firestore().collection('users').doc(user.uid).get()
              .then((doc) => {
                if (doc.exists) {
                  setCurrentUser({
                    id: user.uid,
                    email: user.email,
                    ...doc.data()
                  });
                  setScreen('lobby');
                }
                setLoading(false);
              });
          } else {
            setLoading(false);
          }
        });

        return () => unsubscribe();
      }, []);

      // ãƒ­ã‚°ã‚¤ãƒ³
      const handleLogin = async () => {
        try {
          setLoading(true);
          await firebase.auth().signInWithEmailAndPassword(email, password);
        } catch (error) {
          alert('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          setLoading(false);
        }
      };

      // æ–°è¦ç™»éŒ²
      const handleRegister = async () => {
        if (!name || !email || !password) {
          alert('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        try {
          setLoading(true);
          const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
          
          await firebase.firestore().collection('users').doc(userCredential.user.uid).set({
            name: name,
            email: email,
            type: userType,
            points: userType === 'client' ? 500 : 0,
            createdAt: new Date().toISOString()
          });
        } catch (error) {
          alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
          setLoading(false);
        }
      };

      // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
      const handleLogout = async () => {
        await firebase.auth().signOut();
        setCurrentUser(null);
        setScreen('login');
      };

      if (loading) {
        return (
          <div style={{
            minHeight: '100vh',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            background: 'linear-gradient(to right, #ec4899, #a855f7)'
          }}>
            <div style={{ color: 'white', fontSize: '20px' }}>èª­ã¿è¾¼ã¿ä¸­...</div>
          </div>
        );
      }

      // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
      if (screen === 'login') {
        return (
          <div style={{ 
            minHeight: '100vh', 
            background: '#f9fafb', 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'center', 
            padding: '16px' 
          }}>
            <div style={{ 
              maxWidth: '400px', 
              width: '100%', 
              background: 'white', 
              borderRadius: '12px', 
              padding: '32px', 
              boxShadow: '0 4px 12px rgba(0,0,0,0.1)' 
            }}>
              <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                <div style={{ fontSize: '48px', marginBottom: '8px' }}>ğŸŒ™ğŸ’•</div>
                <h1 style={{ 
                  fontSize: '32px', 
                  fontWeight: 'bold', 
                  background: 'linear-gradient(to right, #ec4899, #a855f7)', 
                  WebkitBackgroundClip: 'text', 
                  WebkitTextFillColor: 'transparent', 
                  marginBottom: '8px' 
                }}>
                  Cupids
                </h1>
                <p style={{ fontSize: '13px', color: '#ec4899', fontWeight: 'bold' }}>
                  æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡
                </p>
              </div>

              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="your@email.com"
                />
              </div>

              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                  style={{
                    width: '100%',
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                />
              </div>

              <button
                onClick={handleLogin}
                style={{
                  width: '100%',
                  padding: '12px',
                  background: 'linear-gradient(to right, #ec4899, #a855f7)',
                  color: 'white',
                  borderRadius: '8px',
                  border: 'none',
                  cursor: 'pointer',
                  fontSize: '16px',
                  fontWeight: '600',
                  marginBottom: '16px'
                }}
              >
                ãƒ­ã‚°ã‚¤ãƒ³
              </button>

              <div style={{ textAlign: 'center', fontSize: '14px', color: '#6b7280' }}>
                ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯
                <button
                  onClick={() => setScreen('register')}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: '#ec4899',
                    cursor: 'pointer',
                    textDecoration: 'underline',
                    marginLeft: '4px'
                  }}
                >
                  æ–°è¦ç™»éŒ²
                </button>
              </div>
            </div>
          </div>
        );
      }

      // æ–°è¦ç™»éŒ²ç”»é¢
      if (screen === 'register') {
        return (
          <div style={{ 
            minHeight: '100vh', 
            background: '#f9fafb', 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'center', 
            padding: '16px' 
          }}>
            <div style={{ 
              maxWidth: '400px', 
              width: '100%', 
              background: 'white', 
              borderRadius: '12px', 
              padding: '32px', 
              boxShadow: '0 4px 12px rgba(0,0,0,0.1)' 
            }}>
              <div style={{ marginBottom: '24px' }}>
                <button
                  onClick={() => setScreen('login')}
                  style={{
                    background: 'none',
                    border: 'none',
                    color: '#6b7280',
                    cursor: 'pointer',
                    fontSize: '14px'
                  }}
                >
                  â† ãƒ­ã‚°ã‚¤ãƒ³ã«æˆ»ã‚‹
                </button>
              </div>

              <h2 style={{ fontSize: '24px', fontWeight: 'bold', color: '#1f2937', marginBottom: '24px' }}>
                æ–°è¦ç™»éŒ²
              </h2>

              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  ãŠåå‰
                </label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="å±±ç”°å¤ªéƒ"
                />
              </div>

              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="your@email.com"
                />
              </div>

              <div style={{ marginBottom: '16px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  style={{
                    width: '100%',
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="6æ–‡å­—ä»¥ä¸Š"
                />
              </div>

              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', fontSize: '14px', fontWeight: '500', color: '#374151', marginBottom: '8px' }}>
                  åˆ©ç”¨ã‚¿ã‚¤ãƒ—
                </label>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <button
                    onClick={() => setUserType('client')}
                    style={{
                      flex: 1,
                      padding: '12px',
                      border: `2px solid ${userType === 'client' ? '#ec4899' : '#d1d5db'}`,
                      borderRadius: '8px',
                      background: userType === 'client' ? '#fdf2f8' : 'white',
                      cursor: 'pointer',
                      fontSize: '14px',
                      fontWeight: '600',
                      color: userType === 'client' ? '#ec4899' : '#6b7280'
                    }}
                  >
                    ğŸ‘¤ ãŠå®¢æ§˜
                  </button>
                  <button
                    onClick={() => setUserType('fortune-teller')}
                    style={{
                      flex: 1,
                      padding: '12px',
                      border: `2px solid ${userType === 'fortune-teller' ? '#a855f7' : '#d1d5db'}`,
                      borderRadius: '8px',
                      background: userType === 'fortune-teller' ? '#faf5ff' : 'white',
                      cursor: 'pointer',
                      fontSize: '14px',
                      fontWeight: '600',
                      color: userType === 'fortune-teller' ? '#a855f7' : '#6b7280'
                    }}
                  >
                    ğŸ”® å ã„å¸«
                  </button>
                </div>
              </div>

              <button
                onClick={handleRegister}
                style={{
                  width: '100%',
                  padding: '12px',
                  background: 'linear-gradient(to right, #ec4899, #a855f7)',
                  color: 'white',
                  borderRadius: '8px',
                  border: 'none',
                  cursor: 'pointer',
                  fontSize: '16px',
                  fontWeight: '600'
                }}
              >
                ç™»éŒ²ã™ã‚‹
              </button>
            </div>
          </div>
        );
      }

      // ãƒ­ãƒ“ãƒ¼ç”»é¢
      return (
        <div style={{ minHeight: '100vh', background: '#f9fafb' }}>
          <div style={{
            background: 'linear-gradient(to right, #ec4899, #a855f7)',
            padding: '16px',
            boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
          }}>
            <div style={{
              maxWidth: '1200px',
              margin: '0 auto',
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center'
            }}>
              <div>
                <h1 style={{ fontSize: '24px', fontWeight: 'bold', color: 'white', marginBottom: '4px' }}>
                  Cupids
                </h1>
                <p style={{ fontSize: '12px', color: 'rgba(255,255,255,0.9)' }}>
                  {currentUser?.name}ã•ã‚“
                </p>
              </div>
              <button
                onClick={handleLogout}
                style={{
                  background: 'rgba(255,255,255,0.2)',
                  color: 'white',
                  padding: '8px 16px',
                  borderRadius: '8px',
                  border: '1px solid rgba(255,255,255,0.3)',
                  cursor: 'pointer',
                  fontSize: '14px',
                  fontWeight: '600'
                }}
              >
                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              </button>
            </div>
          </div>

          <div style={{
            maxWidth: '1200px',
            margin: '0 auto',
            padding: '32px 16px',
            textAlign: 'center'
          }}>
            <div style={{
              background: 'white',
              borderRadius: '12px',
              padding: '48px',
              boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
            }}>
              <div style={{ fontSize: '64px', marginBottom: '16px' }}>ğŸ‰</div>
              <h2 style={{ fontSize: '32px', fontWeight: 'bold', color: '#1f2937', marginBottom: '16px' }}>
                Firebaseé€£æºæˆåŠŸï¼
              </h2>
              <p style={{ fontSize: '16px', color: '#6b7280', marginBottom: '8px' }}>
                ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™
              </p>
              <p style={{ fontSize: '14px', color: '#9ca3af' }}>
                ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {currentUser?.id}
              </p>
              <p style={{ fontSize: '14px', color: '#9ca3af' }}>
                ã‚¿ã‚¤ãƒ—: {currentUser?.type === 'client' ? 'ãŠå®¢æ§˜' : 'å ã„å¸«'}
              </p>
              {currentUser?.type === 'client' && (
                <p style={{ fontSize: '14px', color: '#ec4899', fontWeight: 'bold', marginTop: '8px' }}>
                  æ‰€æŒãƒã‚¤ãƒ³ãƒˆ: {currentUser?.points}pt
                </p>
              )}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CupidsApp />);
  </script>
</body>
</html>
