<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cupids - æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡</title>
  
  <!-- PWAè¨­å®šï¼ˆç°¡ç•¥åŒ–ï¼‰ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸ”®</text></svg>">
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <!-- React & Babel for JSX -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- ğŸ”¥ Firebase SDK ã‚’è¿½åŠ  -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to bottom, #fdf2f8, #fce7f3);
      color: #111827;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(236, 72, 153, 0.3);
      border-radius: 3px;
    }
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 24px;
      border-radius: 24px;
      z-index: 10000;
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { Heart, MessageCircle, Star, User, Settings, LogOut, Send, Search, Bell, 
            Gift, CreditCard, Home, ChevronLeft, ArrowLeft, Plus, Wallet, 
            DollarSign, TrendingUp, Clock, FileText, UserPlus, Users } = lucide;
    
    // ğŸ”¥ ===== Firebaseè¨­å®š ===== ğŸ”¥
    let auth = null;
    let db = null;
    let firebaseEnabled = false;
    
    try {
      // Firebaseè¨­å®šï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼‰
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      
      // FirebaseãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
      if (typeof firebase !== 'undefined' && firebaseConfig.apiKey !== "YOUR_API_KEY") {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        firebaseEnabled = true;
        console.log('ğŸ”¥ FirebaseåˆæœŸåŒ–å®Œäº†ï¼');
      } else {
        console.log('ğŸ“ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­ï¼ˆFirebaseæœªè¨­å®šï¼‰');
      }
    } catch (error) {
      console.log('âš ï¸ FirebaseåˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—:', error.message);
      console.log('ğŸ“ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™');
    }
    
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã‚’ä¿æŒ
    let unsubscribeMessages = null;
    let unsubscribeFortuneTellers = null;
    
    // ===== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ =====
    function FortuneServiceApp() {
      const [screen, setScreen] = useState('login');
      const [currentUser, setCurrentUser] = useState(null);
      const [loading, setLoading] = useState(false);
      const [toast, setToast] = useState(null);
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [selectedFortuneTeller, setSelectedFortuneTeller] = useState(null);
      const [fortuneTellers, setFortuneTellers] = useState([]);
      const [points, setPoints] = useState(0);
      const [isTyping, setIsTyping] = useState(false);
      
      // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
      const showToast = (message) => {
        setToast(message);
        setTimeout(() => setToast(null), 3000);
      };
      
      // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      const formatDate = (date) => {
        const d = date instanceof Date ? date : new Date(date);
        return `${d.getMonth() + 1}/${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2, '0')}`;
      };
      
      // ğŸ”¥ ===== Firebaseèªè¨¼ãƒªã‚¹ãƒŠãƒ¼ ===== ğŸ”¥
      useEffect(() => {
        if (!firebaseEnabled || !auth) {
          // FirebaseãŒç„¡åŠ¹ãªå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
          setLoading(false);
          return;
        }
        
        const unsubscribe = auth.onAuthStateChanged(async (user) => {
          if (user) {
            // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
            try {
              const userDoc = await db.collection('users').doc(user.uid).get();
              if (userDoc.exists) {
                const userData = userDoc.data();
                setCurrentUser({
                  id: user.uid,
                  email: user.email,
                  ...userData
                });
                setPoints(userData.points || 0);
                
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ç”»é¢ã‚’è¨­å®š
                if (userData.type === 'admin') {
                  setScreen('admin');
                } else {
                  setScreen('lobby');
                }
              } else {
                // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯Firestoreã«ä½œæˆ
                const newUserData = {
                  email: user.email,
                  name: user.displayName || 'ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                  type: 'client',
                  points: 1000, // åˆå›ãƒœãƒ¼ãƒŠã‚¹
                  avatar: 'ğŸ‘¤',
                  createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('users').doc(user.uid).set(newUserData);
                setCurrentUser({ id: user.uid, ...newUserData });
                setPoints(1000);
                setScreen('lobby');
              }
            } catch (error) {
              console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
              showToast('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
          } else {
            setCurrentUser(null);
            setScreen('login');
          }
          setLoading(false);
        });
        
        return () => unsubscribe();
      }, []);
      
      // ğŸ”¥ ===== å ã„å¸«ãƒªã‚¹ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾— ===== ğŸ”¥
      useEffect(() => {
        // FirebaseãŒç„¡åŠ¹ãªå ´åˆã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
        if (!firebaseEnabled || !db) {
          setFortuneTellers([
            {
              id: '1',
              name: 'æœˆé‡ã†ã•ã',
              avatar: 'ğŸ”®',
              specialty: 'ã‚¿ãƒ­ãƒƒãƒˆ',
              rating: 4.8,
              reviews: 324,
              price: 300,
              status: 'online',
              introduction: 'æ‹æ„›ã®ãŠæ‚©ã¿ã¯ãŠä»»ã›ãã ã•ã„â™¡',
              categories: ['æ‹æ„›', 'çµå©š', 'äººé–“é–¢ä¿‚']
            },
            {
              id: '2',
              name: 'æ˜Ÿé‡ãƒ«ãƒ“ãƒ¼',
              avatar: 'âœ¨',
              specialty: 'è¥¿æ´‹å æ˜Ÿè¡“',
              rating: 4.9,
              reviews: 456,
              price: 350,
              status: 'online',
              introduction: 'é‹å‘½ã®æ˜ŸãŒã‚ãªãŸã‚’å°ãã¾ã™',
              categories: ['ä»•äº‹', 'è»¢è·', 'é‡‘é‹']
            }
          ]);
          return;
        }
        
        if (unsubscribeFortuneTellers) {
          unsubscribeFortuneTellers();
        }
        
        // Firestoreã‹ã‚‰å ã„å¸«ãƒªã‚¹ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—
        unsubscribeFortuneTellers = db.collection('fortuneTellers')
          .onSnapshot((snapshot) => {
            const ftList = [];
            snapshot.forEach((doc) => {
              ftList.push({ id: doc.id, ...doc.data() });
            });
            
            // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            if (ftList.length === 0) {
              setFortuneTellers([
                {
                  id: '1',
                  name: 'æœˆé‡ã†ã•ã',
                  avatar: 'ğŸ”®',
                  specialty: 'ã‚¿ãƒ­ãƒƒãƒˆ',
                  rating: 4.8,
                  reviews: 324,
                  price: 300,
                  status: 'online',
                  introduction: 'æ‹æ„›ã®ãŠæ‚©ã¿ã¯ãŠä»»ã›ãã ã•ã„â™¡',
                  categories: ['æ‹æ„›', 'çµå©š', 'äººé–“é–¢ä¿‚']
                },
                {
                  id: '2',
                  name: 'æ˜Ÿé‡ãƒ«ãƒ“ãƒ¼',
                  avatar: 'âœ¨',
                  specialty: 'è¥¿æ´‹å æ˜Ÿè¡“',
                  rating: 4.9,
                  reviews: 456,
                  price: 350,
                  status: 'online',
                  introduction: 'é‹å‘½ã®æ˜ŸãŒã‚ãªãŸã‚’å°ãã¾ã™',
                  categories: ['ä»•äº‹', 'è»¢è·', 'é‡‘é‹']
                }
              ]);
            } else {
              setFortuneTellers(ftList);
            }
          }, (error) => {
            console.error('å ã„å¸«ãƒªã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨
            setFortuneTellers([
              {
                id: '1',
                name: 'æœˆé‡ã†ã•ã',
                avatar: 'ğŸ”®',
                specialty: 'ã‚¿ãƒ­ãƒƒãƒˆ',
                rating: 4.8,
                reviews: 324,
                price: 300,
                status: 'online',
                introduction: 'æ‹æ„›ã®ãŠæ‚©ã¿ã¯ãŠä»»ã›ãã ã•ã„â™¡',
                categories: ['æ‹æ„›', 'çµå©š', 'äººé–“é–¢ä¿‚']
              }
            ]);
          });
        
        return () => {
          if (unsubscribeFortuneTellers) {
            unsubscribeFortuneTellers();
          }
        };
      }, []);
      
      // ğŸ”¥ ===== ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç† (Firebase Auth) ===== ğŸ”¥
      const handleLogin = async (email, password) => {
        setLoading(true);
        
        try {
          // ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒã‚§ãƒƒã‚¯
          if (email === 'demo@client.com' && password === 'demo') {
            // ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”¨ã®å‡¦ç†ï¼ˆFirebaseã‚’ä½¿ã‚ãªã„ï¼‰
            setCurrentUser({
              id: 'demo-client',
              name: 'ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼',
              type: 'client',
              email: 'demo@client.com',
              avatar: 'ğŸ‘¤',
              points: 1000
            });
            setPoints(1000);
            setScreen('lobby');
            showToast('ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
          } else if (email === 'memetan@cupids.com' && password === 'admin123') {
            // ç®¡ç†è€…ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
            setCurrentUser({
              id: 'demo-admin',
              name: 'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…',
              type: 'admin',
              email: 'memetan@cupids.com',
              avatar: 'ğŸ‘‘'
            });
            setScreen('admin');
            showToast('ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
          } else {
            // Firebaseèªè¨¼ã‚’ä½¿ç”¨
            const userCredential = await auth.signInWithEmailAndPassword(email, password);
            showToast('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
          }
        } catch (error) {
          console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
          if (error.code === 'auth/user-not-found') {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
            try {
              const userCredential = await auth.createUserWithEmailAndPassword(email, password);
              showToast('æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ');
            } catch (createError) {
              showToast('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + createError.message);
            }
          } else {
            showToast('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
          }
        }
        
        setLoading(false);
      };
      
      // ğŸ”¥ ===== ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç† ===== ğŸ”¥
      const handleLogout = async () => {
        try {
          if (currentUser?.id?.startsWith('demo-')) {
            // ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆ
            setCurrentUser(null);
            setScreen('login');
            setMessages([]);
            showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
          } else if (firebaseEnabled && auth) {
            // Firebaseèªè¨¼ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
            await auth.signOut();
            showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
          } else {
            // FirebaseãŒç„¡åŠ¹ãªå ´åˆ
            setCurrentUser(null);
            setScreen('login');
            setMessages([]);
            showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
          }
        } catch (error) {
          console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
          showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };
      
      // ğŸ”¥ ===== ãƒãƒ£ãƒƒãƒˆé€ä¿¡å‡¦ç† (Firestore) ===== ğŸ”¥
      const handleSendMessage = async () => {
        if (inputMessage.trim() === '' || !selectedFortuneTeller) return;
        
        const newMessage = {
          text: inputMessage,
          sender: currentUser?.type === 'fortuneTeller' ? 'fortune' : 'client',
          senderId: currentUser?.id,
          senderName: currentUser?.name,
          timestamp: new Date(),
          avatar: currentUser?.avatar || 'ğŸ‘¤'
        };
        
        // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯FirebaseãŒç„¡åŠ¹ã®å ´åˆ
        if (!firebaseEnabled || !db || currentUser?.id?.startsWith('demo-')) {
          setMessages(prev => [...prev, { ...newMessage, id: Date.now() }]);
          setInputMessage('');
          
          // ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»
          if (currentUser?.type === 'client') {
            setPoints(prev => Math.max(0, prev - 50));
          }
          
          // è‡ªå‹•è¿”ä¿¡
          setIsTyping(true);
          setTimeout(() => {
            const autoReply = {
              id: Date.now() + 1,
              text: 'ã‚«ãƒ¼ãƒ‰ãŒç¤ºã—ã¦ã„ã¾ã™ã­...',
              sender: 'fortune',
              timestamp: new Date(),
              avatar: selectedFortuneTeller?.avatar || 'ğŸ”®'
            };
            setMessages(prev => [...prev, autoReply]);
            setIsTyping(false);
          }, 2000);
          
          return;
        }
        
        // Firestoreã«ä¿å­˜
        try {
          const chatId = [currentUser?.id, selectedFortuneTeller?.id].sort().join('-');
          await db.collection('chats').doc(chatId).collection('messages').add({
            ...newMessage,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
          
          setInputMessage('');
          
          // ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»
          if (currentUser?.type === 'client' && points >= 50) {
            const newPoints = points - 50;
            setPoints(newPoints);
            await db.collection('users').doc(currentUser.id).update({
              points: newPoints
            });
          }
        } catch (error) {
          console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
          showToast('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };
      
      // ğŸ”¥ ===== ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾— ===== ğŸ”¥
      useEffect(() => {
        if (!firebaseEnabled || !db || !selectedFortuneTeller || !currentUser || currentUser?.id?.startsWith('demo-')) return;
        
        const chatId = [currentUser?.id, selectedFortuneTeller?.id].sort().join('-');
        
        // æ—¢å­˜ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        if (unsubscribeMessages) {
          unsubscribeMessages();
        }
        
        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        unsubscribeMessages = db.collection('chats')
          .doc(chatId)
          .collection('messages')
          .orderBy('timestamp', 'asc')
          .onSnapshot((snapshot) => {
            const msgs = [];
            snapshot.forEach((doc) => {
              msgs.push({ id: doc.id, ...doc.data() });
            });
            setMessages(msgs);
          });
        
        return () => {
          if (unsubscribeMessages) {
            unsubscribeMessages();
          }
        };
      }, [selectedFortuneTeller, currentUser]);
      
      // ===== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ =====
      const LoginScreen = () => {
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        
        return (
          <div style={{
            minHeight: '100vh',
            background: 'linear-gradient(to bottom, #fdf2f8, #fce7f3)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '20px'
          }}>
            <div style={{
              background: 'white',
              borderRadius: '20px',
              padding: '32px',
              maxWidth: '400px',
              width: '100%',
              boxShadow: '0 10px 40px rgba(236, 72, 153, 0.1)'
            }}>
              <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                <div style={{
                  width: '80px',
                  height: '80px',
                  margin: '0 auto 16px',
                  background: 'linear-gradient(135deg, #ec4899, #f472b6)',
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: '40px'
                }}>
                  ğŸ”®
                </div>
                <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#111827', marginBottom: '8px' }}>
                  Cupids
                </h1>
                <p style={{ fontSize: '14px', color: '#6b7280' }}>
                  æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡
                </p>
                <div style={{
                  marginTop: '16px',
                  padding: '8px',
                  background: firebaseEnabled ? '#dcfce7' : '#fef3c7',
                  borderRadius: '8px',
                  fontSize: '12px',
                  color: firebaseEnabled ? '#166534' : '#78350f'
                }}>
                  {firebaseEnabled ? 'ğŸ”¥ Firebaseæ¥ç¶šä¸­' : 'ğŸ“ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆFirebaseæœªè¨­å®šï¼‰'}
                </div>
              </div>
              
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#374151', fontWeight: '500' }}>
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                </label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="email@example.com"
                  style={{
                    width: '100%',
                    padding: '12px',
                    borderRadius: '8px',
                    border: '1px solid #e5e7eb',
                    fontSize: '14px'
                  }}
                />
              </div>
              
              <div style={{ marginBottom: '24px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#374151', fontWeight: '500' }}>
                  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                </label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  style={{
                    width: '100%',
                    padding: '12px',
                    borderRadius: '8px',
                    border: '1px solid #e5e7eb',
                    fontSize: '14px'
                  }}
                />
              </div>
              
              <button
                onClick={() => handleLogin(email, password)}
                disabled={loading}
                style={{
                  width: '100%',
                  padding: '14px',
                  borderRadius: '8px',
                  border: 'none',
                  background: loading ? '#e5e7eb' : 'linear-gradient(135deg, #ec4899, #f472b6)',
                  color: loading ? '#9ca3af' : 'white',
                  fontWeight: '600',
                  fontSize: '16px',
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²'}
              </button>
              
              <div style={{
                marginTop: '24px',
                padding: '16px',
                background: '#f9fafb',
                borderRadius: '8px',
                fontSize: '12px',
                color: '#6b7280'
              }}>
                <p style={{ marginBottom: '8px', fontWeight: 'bold', color: '#374151' }}>
                  ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼š
                </p>
                <p style={{ marginBottom: '4px' }}>
                  ãŠå®¢æ§˜: demo@client.com / demo
                </p>
                <p>
                  ç®¡ç†è€…: memetan@cupids.com / admin123
                </p>
                <p style={{ marginTop: '8px', color: '#ec4899' }}>
                  â€» æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯è‡ªå‹•ä½œæˆã•ã‚Œã¾ã™
                </p>
              </div>
            </div>
          </div>
        );
      };
      
      // ===== ãƒ­ãƒ“ãƒ¼ç”»é¢ =====
      const LobbyScreen = () => {
        return (
          <div style={{ minHeight: '100vh', background: '#f9fafb' }}>
            <div style={{
              background: 'linear-gradient(135deg, #ec4899, #f472b6)',
              padding: '20px 16px',
              color: 'white'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <h1 style={{ fontSize: '24px', margin: '0', fontWeight: '700' }}>
                    Cupids
                  </h1>
                  <p style={{ fontSize: '12px', marginTop: '4px', opacity: '0.9' }}>
                    {currentUser?.name}ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼
                  </p>
                </div>
                <button
                  onClick={handleLogout}
                  style={{
                    width: '40px',
                    height: '40px',
                    borderRadius: '50%',
                    border: 'none',
                    background: 'rgba(255, 255, 255, 0.2)',
                    color: 'white',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  <LogOut style={{ width: '20px', height: '20px' }} />
                </button>
              </div>
            </div>
            
            <div style={{
              margin: '16px',
              padding: '12px 16px',
              background: 'linear-gradient(135deg, #fef3c7, #fde68a)',
              borderRadius: '12px',
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center'
            }}>
              <div>
                <p style={{ fontSize: '12px', color: '#78350f', marginBottom: '4px' }}>ä¿æœ‰ãƒã‚¤ãƒ³ãƒˆ</p>
                <p style={{ fontSize: '20px', fontWeight: '700', color: '#78350f' }}>
                  {points.toLocaleString()}pt
                </p>
              </div>
              <button
                style={{
                  padding: '8px 20px',
                  borderRadius: '20px',
                  border: 'none',
                  background: '#f59e0b',
                  color: 'white',
                  fontWeight: '600',
                  fontSize: '14px',
                  cursor: 'pointer'
                }}
              >
                <Plus style={{ width: '16px', height: '16px', marginRight: '4px', verticalAlign: 'middle' }} />
                è³¼å…¥ã™ã‚‹
              </button>
            </div>
            
            <div style={{ padding: '0 16px 16px' }}>
              <h3 style={{ fontSize: '16px', fontWeight: '600', color: '#111827', marginBottom: '12px' }}>
                å ã„å¸«ä¸€è¦§
              </h3>
              
              <div style={{ display: 'grid', gap: '12px' }}>
                {fortuneTellers.map(fortuneTeller => (
                  <div
                    key={fortuneTeller.id}
                    style={{
                      background: 'white',
                      borderRadius: '16px',
                      padding: '16px',
                      border: '1px solid #e5e7eb',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onClick={() => {
                      setSelectedFortuneTeller(fortuneTeller);
                      setScreen('chat');
                    }}
                  >
                    <div style={{ display: 'flex', gap: '12px' }}>
                      <div style={{
                        width: '60px',
                        height: '60px',
                        borderRadius: '50%',
                        background: 'linear-gradient(135deg, #fce7f3, #fdf2f8)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '32px'
                      }}>
                        {fortuneTeller.avatar}
                      </div>
                      
                      <div style={{ flex: '1' }}>
                        <h4 style={{ margin: '0 0 4px 0', color: '#111827', fontSize: '16px' }}>
                          {fortuneTeller.name}
                        </h4>
                        <p style={{ fontSize: '12px', color: '#6b7280', marginBottom: '8px' }}>
                          {fortuneTeller.specialty}
                        </p>
                        <p style={{ fontSize: '13px', color: '#374151' }}>
                          {fortuneTeller.introduction}
                        </p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };
      
      // ===== ãƒãƒ£ãƒƒãƒˆç”»é¢ =====
      const ChatScreen = () => {
        const messagesEndRef = useRef(null);
        
        useEffect(() => {
          messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages]);
        
        return (
          <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', background: '#f9fafb' }}>
            <div style={{
              padding: '16px',
              background: 'white',
              borderBottom: '1px solid #e5e7eb',
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              <button
                onClick={() => {
                  setScreen('lobby');
                  setMessages([]);
                  setSelectedFortuneTeller(null);
                }}
                style={{
                  width: '40px',
                  height: '40px',
                  borderRadius: '50%',
                  border: 'none',
                  background: '#f3f4f6',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}
              >
                <ArrowLeft style={{ width: '20px', height: '20px', color: '#374151' }} />
              </button>
              
              <div style={{ flex: '1' }}>
                <p style={{ fontWeight: '600', color: '#111827' }}>
                  {selectedFortuneTeller?.name || 'å ã„å¸«'}
                </p>
                <p style={{ fontSize: '12px', color: '#6b7280' }}>
                  {isTyping ? 'å…¥åŠ›ä¸­...' : 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³'}
                </p>
              </div>
            </div>
            
            <div style={{
              flex: '1',
              overflowY: 'auto',
              padding: '16px',
              display: 'flex',
              flexDirection: 'column',
              gap: '12px'
            }}>
              {messages.length === 0 && (
                <div style={{
                  textAlign: 'center',
                  color: '#9ca3af',
                  padding: '40px',
                  fontSize: '14px'
                }}>
                  <MessageCircle style={{ width: '48px', height: '48px', margin: '0 auto 16px', color: '#e5e7eb' }} />
                  <p>ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
                  <p style={{ marginTop: '8px', fontSize: '12px' }}>1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: 50ãƒã‚¤ãƒ³ãƒˆ</p>
                </div>
              )}
              
              {messages.map(message => (
                <div
                  key={message.id}
                  style={{
                    display: 'flex',
                    flexDirection: message.sender === 'client' ? 'row-reverse' : 'row',
                    gap: '8px',
                    alignItems: 'flex-start'
                  }}
                  className="fade-in"
                >
                  <span style={{ fontSize: '20px' }}>{message.avatar}</span>
                  <div
                    style={{
                      maxWidth: '70%',
                      padding: '12px 16px',
                      borderRadius: '18px',
                      background: message.sender === 'client' 
                        ? 'linear-gradient(135deg, #ec4899, #f472b6)'
                        : 'white',
                      color: message.sender === 'client' ? 'white' : '#111827',
                      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)'
                    }}
                  >
                    <p style={{ margin: '0' }}>{message.text}</p>
                    <p style={{
                      fontSize: '10px',
                      marginTop: '4px',
                      opacity: '0.7'
                    }}>
                      {message.timestamp ? formatDate(message.timestamp.toDate ? message.timestamp.toDate() : message.timestamp) : ''}
                    </p>
                  </div>
                </div>
              ))}
              
              <div ref={messagesEndRef} />
            </div>
            
            <div style={{
              padding: '16px',
              background: 'white',
              borderTop: '1px solid #e5e7eb',
              display: 'flex',
              gap: '12px'
            }}>
              <input
                type="text"
                value={inputMessage}
                onChange={(e) => setInputMessage(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                style={{
                  flex: '1',
                  padding: '10px 16px',
                  borderRadius: '24px',
                  border: '1px solid #e5e7eb',
                  fontSize: '14px',
                  outline: 'none'
                }}
              />
              
              <button
                onClick={handleSendMessage}
                disabled={inputMessage.trim() === '' || points < 50}
                style={{
                  width: '40px',
                  height: '40px',
                  borderRadius: '50%',
                  border: 'none',
                  background: inputMessage.trim() === '' || points < 50
                    ? '#e5e7eb'
                    : 'linear-gradient(135deg, #ec4899, #f472b6)',
                  color: 'white',
                  cursor: inputMessage.trim() === '' || points < 50 ? 'not-allowed' : 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center'
                }}
              >
                <Send style={{ width: '20px', height: '20px' }} />
              </button>
            </div>
          </div>
        );
      };
      
      // ===== ç®¡ç†è€…ç”»é¢ =====
      const AdminScreen = () => {
        const [stats, setStats] = useState({
          totalUsers: 0,
          totalFortuneTellers: 0,
          totalRevenue: 0,
          totalChats: 0
        });
        
        useEffect(() => {
          const fetchStats = async () => {
            try {
              if (!firebaseEnabled || !db) {
                throw new Error('Firebase not available');
              }
              // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°å–å¾—
              const usersSnapshot = await db.collection('users').get();
              const ftSnapshot = await db.collection('fortuneTellers').get();
              
              setStats({
                totalUsers: usersSnapshot.size,
                totalFortuneTellers: ftSnapshot.size,
                totalRevenue: 3200000, // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
                totalChats: 8456 // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
              });
            } catch (error) {
              console.error('çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
              // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨
              setStats({
                totalUsers: 1234,
                totalFortuneTellers: 56,
                totalRevenue: 3200000,
                totalChats: 8456
              });
            }
          };
          
          if (!currentUser?.id?.startsWith('demo-')) {
            fetchStats();
          } else {
            // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
            setStats({
              totalUsers: 1234,
              totalFortuneTellers: 56,
              totalRevenue: 3200000,
              totalChats: 8456
            });
          }
        }, [currentUser]);
        
        return (
          <div style={{ minHeight: '100vh', background: '#f9fafb' }}>
            <div style={{
              background: 'linear-gradient(135deg, #8b5cf6, #a78bfa)',
              padding: '20px 16px',
              color: 'white'
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <h1 style={{ fontSize: '24px', margin: '0', fontWeight: '700' }}>
                    ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                  </h1>
                  <p style={{ fontSize: '12px', marginTop: '4px', opacity: '0.9' }}>
                    {firebaseEnabled ? 'ğŸ”¥ Firebaseçµ±åˆç‰ˆ' : 'ğŸ“ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰'}
                  </p>
                </div>
                <button
                  onClick={handleLogout}
                  style={{
                    padding: '8px 16px',
                    borderRadius: '20px',
                    border: 'none',
                    background: 'rgba(255, 255, 255, 0.2)',
                    color: 'white',
                    fontWeight: '600',
                    fontSize: '14px',
                    cursor: 'pointer'
                  }}
                >
                  <LogOut style={{ width: '16px', height: '16px', marginRight: '4px', verticalAlign: 'middle' }} />
                  ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
              </div>
            </div>
            
            <div style={{ padding: '20px' }}>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '16px', marginBottom: '24px' }}>
                <div style={{
                  background: 'white',
                  borderRadius: '12px',
                  padding: '20px',
                  border: '1px solid #e5e7eb'
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                    <div style={{
                      width: '48px',
                      height: '48px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #3b82f6, #60a5fa)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white'
                    }}>
                      <Users style={{ width: '24px', height: '24px' }} />
                    </div>
                    <span style={{ fontSize: '12px', color: '#10b981', fontWeight: '600' }}>
                      +12%
                    </span>
                  </div>
                  <p style={{ fontSize: '24px', fontWeight: '700', color: '#111827' }}>
                    {stats.totalUsers.toLocaleString()}
                  </p>
                  <p style={{ fontSize: '14px', color: '#6b7280' }}>
                    ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
                  </p>
                </div>
                
                <div style={{
                  background: 'white',
                  borderRadius: '12px',
                  padding: '20px',
                  border: '1px solid #e5e7eb'
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                    <div style={{
                      width: '48px',
                      height: '48px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #ec4899, #f472b6)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white'
                    }}>
                      <Star style={{ width: '24px', height: '24px' }} />
                    </div>
                    <span style={{ fontSize: '12px', color: '#10b981', fontWeight: '600' }}>
                      +5%
                    </span>
                  </div>
                  <p style={{ fontSize: '24px', fontWeight: '700', color: '#111827' }}>
                    {stats.totalFortuneTellers}
                  </p>
                  <p style={{ fontSize: '14px', color: '#6b7280' }}>
                    å ã„å¸«æ•°
                  </p>
                </div>
                
                <div style={{
                  background: 'white',
                  borderRadius: '12px',
                  padding: '20px',
                  border: '1px solid #e5e7eb'
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                    <div style={{
                      width: '48px',
                      height: '48px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #10b981, #34d399)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white'
                    }}>
                      <DollarSign style={{ width: '24px', height: '24px' }} />
                    </div>
                    <span style={{ fontSize: '12px', color: '#10b981', fontWeight: '600' }}>
                      +18%
                    </span>
                  </div>
                  <p style={{ fontSize: '24px', fontWeight: '700', color: '#111827' }}>
                    Â¥{(stats.totalRevenue / 1000000).toFixed(1)}M
                  </p>
                  <p style={{ fontSize: '14px', color: '#6b7280' }}>
                    æœˆé–“å£²ä¸Š
                  </p>
                </div>
                
                <div style={{
                  background: 'white',
                  borderRadius: '12px',
                  padding: '20px',
                  border: '1px solid #e5e7eb'
                }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                    <div style={{
                      width: '48px',
                      height: '48px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #f59e0b, #fbbf24)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: 'white'
                    }}>
                      <MessageCircle style={{ width: '24px', height: '24px' }} />
                    </div>
                    <span style={{ fontSize: '12px', color: '#10b981', fontWeight: '600' }}>
                      +23%
                    </span>
                  </div>
                  <p style={{ fontSize: '24px', fontWeight: '700', color: '#111827' }}>
                    {stats.totalChats.toLocaleString()}
                  </p>
                  <p style={{ fontSize: '14px', color: '#6b7280' }}>
                    æœˆé–“ç›¸è«‡æ•°
                  </p>
                </div>
              </div>
              
              <div style={{ background: 'white', borderRadius: '12px', padding: '20px', border: '1px solid #e5e7eb' }}>
                <h3 style={{ fontSize: '16px', fontWeight: '600', color: '#111827', marginBottom: '16px' }}>
                  ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
                </h3>
                <div style={{ display: 'grid', gap: '12px' }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '12px',
                    padding: '12px',
                    borderRadius: '8px',
                    background: firebaseEnabled ? '#f0fdf4' : '#fef3c7'
                  }}>
                    <div style={{
                      width: '12px',
                      height: '12px',
                      borderRadius: '50%',
                      background: firebaseEnabled ? '#10b981' : '#f59e0b'
                    }} />
                    <span style={{ fontSize: '14px', color: firebaseEnabled ? '#065f46' : '#78350f' }}>
                      {firebaseEnabled ? 'Firebase: æ¥ç¶šä¸­' : 'ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–'}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };
      
      // ===== ç”»é¢è¡¨ç¤º =====
      return (
        <div style={{ height: '100vh', display: 'flex', flexDirection: 'column' }}>
          {toast && <div className="toast">{toast}</div>}
          
          {loading ? (
            <div style={{
              display: 'flex',
              justifyContent: 'center',
              alignItems: 'center',
              height: '100vh',
              background: 'linear-gradient(to bottom, #fdf2f8, #fce7f3)'
            }}>
              <div style={{ textAlign: 'center' }}>
                <h1 style={{ color: '#ec4899', marginBottom: '16px' }}>Cupids</h1>
                <div>èª­ã¿è¾¼ã¿ä¸­...</div>
              </div>
            </div>
          ) : (
            <>
              {screen === 'login' && <LoginScreen />}
              {screen === 'lobby' && <LobbyScreen />}
              {screen === 'chat' && <ChatScreen />}
              {screen === 'admin' && <AdminScreen />}
            </>
          )}
        </div>
      );
    }
    
    // ã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FortuneServiceApp />);
  </script>
</body>
</html>