<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cupids - ãƒãƒ£ãƒƒãƒˆå ã„</title>
  
  <!-- PWAè¨­å®š -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸŒ™</text></svg>">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#ec4899">
  
  <!-- React & Babel for JSX -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to bottom right, #fef2f7, #fce7f3, #fdf2f8);
      color: #1a1a1a;
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    input, textarea {
      -webkit-user-select: auto;
      user-select: auto;
    }
    
    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(236, 72, 153, 0.1);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #ec4899, #f472b6);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #db2777, #ec4899);
    }
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes sparkle {
      0% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1) rotate(180deg); }
      100% { opacity: 0; transform: scale(0) rotate(360deg); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(236, 72, 153, 0.95), rgba(244, 114, 182, 0.95));
      color: white;
      padding: 14px 28px;
      border-radius: 30px;
      box-shadow: 0 10px 30px rgba(236, 72, 153, 0.3);
      z-index: 10000;
      animation: fadeIn 0.3s ease-out;
      font-weight: 500;
    }
    
    /* ãƒœã‚¿ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .btn-primary {
      background: linear-gradient(135deg, #ec4899, #f472b6);
      color: white;
      padding: 14px 32px;
      border-radius: 30px;
      border: none;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(236, 72, 153, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn-primary:active::before {
      width: 300px;
      height: 300px;
    }
    
    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
    }
    
    /* å ã„å¸«ã‚«ãƒ¼ãƒ‰ */
    .fortune-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(252, 231, 243, 0.98));
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(236, 72, 153, 0.15);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid rgba(236, 72, 153, 0.1);
    }
    
    .fortune-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(236, 72, 153, 0.25);
    }
    
    /* è©•ä¾¡è¡¨ç¤º */
    .rating {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #666;
    }
    
    .rating .stars {
      color: #f59e0b;
      font-weight: bold;
      font-size: 16px;
    }
    
    .rating .count {
      color: #999;
      font-size: 13px;
    }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-badge.online {
      background: linear-gradient(135deg, #10b981, #34d399);
      color: white;
    }
    
    .status-badge.offline {
      background: #e5e7eb;
      color: #6b7280;
    }
    
    .status-badge.busy {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: white;
    }
    
    /* ãƒãƒ£ãƒƒãƒˆãƒãƒ–ãƒ« */
    .chat-bubble {
      max-width: 70%;
      padding: 12px 18px;
      border-radius: 20px;
      margin: 8px 0;
      word-wrap: break-word;
      animation: fadeIn 0.3s ease-out;
    }
    
    .chat-bubble.user {
      background: linear-gradient(135deg, #ec4899, #f472b6);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    
    .chat-bubble.fortune {
      background: white;
      color: #333;
      border: 1px solid #f0f0f0;
      border-bottom-left-radius: 4px;
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn 0.2s ease-out;
    }
    
    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      animation: slideIn 0.3s ease-out;
    }
    
    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
    .input-field {
      width: 100%;
      padding: 14px 20px;
      border: 2px solid rgba(236, 72, 153, 0.2);
      border-radius: 15px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.95);
    }
    
    .input-field:focus {
      outline: none;
      border-color: #ec4899;
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      background: linear-gradient(135deg, #ec4899, #8b5cf6);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(139, 92, 246, 0.3);
    }
    
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .header .subtitle {
      font-size: 14px;
      opacity: 0.95;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { Star, Heart, MessageCircle, User, LogOut, Send, ChevronLeft, 
            Plus, Clock, DollarSign, TrendingUp, Users, Calendar, 
            Menu, Settings, FileText, Wallet, CreditCard } = lucide;
    
    // ===== Firebaseè¨­å®š =====
    let auth = null;
    let db = null;
    let firebaseEnabled = false;
    
    try {
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };
      
      if (typeof firebase !== 'undefined' && firebaseConfig.apiKey !== "YOUR_API_KEY") {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        firebaseEnabled = true;
        console.log('ğŸ”¥ FirebaseåˆæœŸåŒ–å®Œäº†ï¼');
      } else {
        console.log('ğŸ“ ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­ï¼ˆFirebaseæœªè¨­å®šï¼‰');
      }
    } catch (error) {
      console.log('âš ï¸ FirebaseåˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—:', error.message);
    }
    
    // ===== ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ =====
    function CupidsApp() {
      const [screen, setScreen] = useState('login');
      const [currentUser, setCurrentUser] = useState(null);
      const [loading, setLoading] = useState(false);
      const [toast, setToast] = useState(null);
      
      // å ã„å¸«ãƒ‡ãƒ¼ã‚¿
      const [fortuneTellers] = useState([
        {
          id: 1,
          name: 'ä¸ƒæ°´å—',
          avatar: 'ğŸŒŸ',
          status: 'online',
          statusText: 'ã„ã¾ã™ãã‚¹ã‚¿ãƒ¼ãƒˆ',
          rating: 4.92,
          reviews: 3705,
          price: 280,
          introduction: 'æ‹æ„›ã®æ‚©ã¿ã¯ç§ã«ãŠä»»ã›ãã ã•ã„â™¡',
          categories: ['æ‹æ„›', 'çµå©š', 'å¾©ç¸'],
          specialty: 'ã‚¿ãƒ­ãƒƒãƒˆ',
          waitTime: 'ç´„5åˆ†',
          image: null
        },
        {
          id: 2,
          name: 'æœˆé‡ã†ã•ã',
          avatar: 'ğŸ”®',
          status: 'online',
          statusText: 'ã„ã¾ã™ãã‚¹ã‚¿ãƒ¼ãƒˆ',
          rating: 4.85,
          reviews: 2456,
          price: 320,
          introduction: 'é‹å‘½ã®äººã¨ã®å‡ºä¼šã„ã‚’å°ãã¾ã™',
          categories: ['æ‹æ„›', 'äººé–“é–¢ä¿‚', 'ä»•äº‹'],
          specialty: 'è¥¿æ´‹å æ˜Ÿè¡“',
          waitTime: 'ç´„10åˆ†',
          image: null
        },
        {
          id: 3,
          name: 'æ˜Ÿé‡ãƒ«ãƒ“ãƒ¼',
          avatar: 'âœ¨',
          status: 'busy',
          statusText: 'é‘‘å®šä¸­',
          rating: 4.78,
          reviews: 1892,
          price: 300,
          introduction: 'ã‚ãªãŸã®æœªæ¥ã‚’ç…§ã‚‰ã—ã¾ã™',
          categories: ['ä»•äº‹', 'é‡‘é‹', 'è»¢è·'],
          specialty: 'éœŠè¦–',
          waitTime: 'ç´„30åˆ†',
          image: null
        }
      ]);
      
      const [messages, setMessages] = useState([]);
      const [inputMessage, setInputMessage] = useState('');
      const [selectedFortuneTeller, setSelectedFortuneTeller] = useState(null);
      const [points, setPoints] = useState(5000);
      const [purchaseHistory, setPurchaseHistory] = useState([]);
      
      // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
      const showToast = (message) => {
        setToast(message);
        setTimeout(() => setToast(null), 3000);
      };
      
      // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
      const handleLogin = async (email, password) => {
        setLoading(true);
        
        // ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        if (email === 'demo@client.com' && password === 'demo') {
          setCurrentUser({
            id: 'demo',
            name: 'ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼',
            email: email,
            type: 'client',
            points: 5000
          });
          setPoints(5000);
          setScreen('lobby');
          showToast('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
        } else if (firebaseEnabled && auth) {
          // Firebaseèªè¨¼
          try {
            await auth.signInWithEmailAndPassword(email, password);
            showToast('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
          } catch (error) {
            if (error.code === 'auth/user-not-found') {
              await auth.createUserWithEmailAndPassword(email, password);
              showToast('æ–°è¦ç™»éŒ²ã—ã¾ã—ãŸ');
            } else {
              showToast('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
          }
        } else {
          showToast('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
        }
        
        setLoading(false);
      };
      
      // Firebaseèªè¨¼ç›£è¦–
      useEffect(() => {
        if (!firebaseEnabled || !auth) return;
        
        const unsubscribe = auth.onAuthStateChanged((user) => {
          if (user) {
            setCurrentUser({
              id: user.uid,
              email: user.email,
              name: user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',
              type: 'client',
              points: points
            });
            setScreen('lobby');
          }
        });
        
        return () => unsubscribe();
      }, [points]);
      
      // ===== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ =====
      const LoginScreen = () => {
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        
        return (
          <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' }}>
            <div className="card" style={{ maxWidth: '450px', width: '100%', padding: '40px' }}>
              <div style={{ textAlign: 'center', marginBottom: '40px' }}>
                <div style={{ fontSize: '60px', marginBottom: '20px' }}>ğŸŒ™</div>
                <h1 style={{ fontSize: '36px', fontWeight: '700', color: '#ec4899', marginBottom: '12px' }}>
                  Cupids
                </h1>
                <p style={{ fontSize: '16px', color: '#6b7280' }}>
                  ãƒãƒ£ãƒƒãƒˆå ã„
                </p>
                <p style={{ fontSize: '14px', color: '#ec4899', marginTop: '8px', fontWeight: '500' }}>
                  æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡
                </p>
              </div>
              
              <div style={{ marginBottom: '30px' }}>
                <h3 style={{ fontSize: '18px', marginBottom: '20px', color: '#333', fontWeight: '600' }}>
                  ä»Šã™ãå ã‚‹å ã„å¸«
                </h3>
                
                <div className="fortune-card" style={{ marginBottom: '25px' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>
                    <div style={{
                      width: '70px',
                      height: '70px',
                      background: 'linear-gradient(135deg, #fef3c7, #fde68a)',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '32px'
                    }}>
                      {fortuneTellers[0].avatar}
                    </div>
                    <div style={{ flex: 1 }}>
                      <h4 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '6px' }}>
                        {fortuneTellers[0].name}
                      </h4>
                      <div className="rating">
                        <span className="stars">â˜… {fortuneTellers[0].rating}</span>
                        <span className="count">({fortuneTellers[0].reviews.toLocaleString()}ä»¶)</span>
                      </div>
                      <p style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>
                        {fortuneTellers[0].specialty} Â· {fortuneTellers[0].waitTime}å¾…ã¡
                      </p>
                    </div>
                  </div>
                  <button 
                    className="btn-primary" 
                    style={{
                      width: '100%',
                      marginTop: '15px',
                      background: 'linear-gradient(135deg, #10b981, #34d399)'
                    }}
                    onClick={() => {
                      showToast('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
                    }}
                  >
                    ã„ã¾ã™ãã‚¹ã‚¿ãƒ¼ãƒˆ
                  </button>
                </div>
              </div>
              
              <div>
                <div style={{ marginBottom: '20px' }}>
                  <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#374151', fontWeight: '500' }}>
                    ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                  </label>
                  <input
                    type="email"
                    className="input-field"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    placeholder="your@email.com"
                  />
                </div>
                
                <div style={{ marginBottom: '25px' }}>
                  <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', color: '#374151', fontWeight: '500' }}>
                    ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                  </label>
                  <input
                    type="password"
                    className="input-field"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  />
                </div>
                
                <button
                  className="btn-primary"
                  style={{ width: '100%' }}
                  onClick={() => handleLogin(email, password)}
                  disabled={loading}
                >
                  {loading ? 'èª­ã¿è¾¼ã¿ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²'}
                </button>
                
                <div style={{
                  marginTop: '20px',
                  padding: '15px',
                  background: 'rgba(236, 72, 153, 0.05)',
                  borderRadius: '10px',
                  fontSize: '13px',
                  color: '#6b7280'
                }}>
                  <p style={{ fontWeight: '600', color: '#374151', marginBottom: '6px' }}>
                    ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼š
                  </p>
                  <p>ãŠå®¢æ§˜: demo@client.com / demo</p>
                  <p style={{ marginTop: '8px', fontSize: '12px', color: '#ec4899', fontWeight: '500' }}>
                    {firebaseEnabled ? 'â€» æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯è‡ªå‹•ä½œæˆã•ã‚Œã¾ã™' : 'â€» ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆFirebaseæœªè¨­å®šï¼‰'}
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      };
      
      // ===== ãƒ­ãƒ“ãƒ¼ç”»é¢ =====
      const LobbyScreen = () => {
        return (
          <div style={{ minHeight: '100vh' }}>
            <div className="header">
              <h1>
                <span style={{ fontSize: '40px' }}>ğŸŒ™</span>
                Cupids
              </h1>
              <p className="subtitle">æœˆã«ä»£ã‚ã£ã¦ã‚ãªãŸã®æ‹ã‚’å¿œæ´ã—ã¾ã™â™¡</p>
            </div>
            
            <div style={{ padding: '20px' }}>
              <div style={{
                background: 'linear-gradient(135deg, #fef3c7, #fde68a)',
                borderRadius: '15px',
                padding: '15px',
                marginBottom: '20px',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div>
                  <p style={{ fontSize: '14px', color: '#78350f', marginBottom: '4px' }}>ä¿æœ‰ãƒã‚¤ãƒ³ãƒˆ</p>
                  <p style={{ fontSize: '24px', fontWeight: '700', color: '#78350f' }}>
                    {points.toLocaleString()}pt
                  </p>
                </div>
                <button
                  className="btn-primary"
                  style={{ background: 'linear-gradient(135deg, #f59e0b, #fbbf24)' }}
                  onClick={() => setScreen('purchase')}
                >
                  <Plus style={{ width: '18px', height: '18px', marginRight: '6px' }} />
                  è³¼å…¥ã™ã‚‹
                </button>
              </div>
              
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '15px' }}>
                <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#333' }}>
                  å ã„å¸«ä¸€è¦§
                </h2>
                <button
                  onClick={() => {
                    setCurrentUser(null);
                    setScreen('login');
                    showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
                  }}
                  style={{
                    padding: '8px 16px',
                    borderRadius: '20px',
                    border: 'none',
                    background: 'rgba(239, 68, 68, 0.1)',
                    color: '#ef4444',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer'
                  }}
                >
                  <LogOut style={{ width: '16px', height: '16px', marginRight: '4px' }} />
                  ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
              </div>
              
              <div style={{ display: 'grid', gap: '15px' }}>
                {fortuneTellers.map(ft => (
                  <div
                    key={ft.id}
                    className="fortune-card"
                    onClick={() => {
                      setSelectedFortuneTeller(ft);
                      setScreen('chat');
                      showToast(`${ft.name}ã¨ã®é‘‘å®šã‚’é–‹å§‹ã—ã¾ã™`);
                    }}
                  >
                    <div style={{ display: 'flex', gap: '15px' }}>
                      <div style={{
                        width: '80px',
                        height: '80px',
                        background: ft.status === 'online' 
                          ? 'linear-gradient(135deg, #fef3c7, #fde68a)'
                          : 'linear-gradient(135deg, #f3f4f6, #e5e7eb)',
                        borderRadius: '50%',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '36px',
                        position: 'relative'
                      }}>
                        {ft.avatar}
                        {ft.status === 'online' && (
                          <div style={{
                            position: 'absolute',
                            bottom: '4px',
                            right: '4px',
                            width: '20px',
                            height: '20px',
                            background: '#10b981',
                            borderRadius: '50%',
                            border: '3px solid white'
                          }}/>
                        )}
                      </div>
                      
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '6px' }}>
                          <h3 style={{ fontSize: '18px', fontWeight: '600' }}>{ft.name}</h3>
                          <span className={`status-badge ${ft.status}`}>
                            {ft.status === 'online' ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : ft.status === 'busy' ? 'é‘‘å®šä¸­' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}
                          </span>
                        </div>
                        
                        <div className="rating" style={{ marginBottom: '8px' }}>
                          <span className="stars">â˜… {ft.rating}</span>
                          <span className="count">({ft.reviews.toLocaleString()}ä»¶)</span>
                        </div>
                        
                        <p style={{ fontSize: '14px', color: '#6b7280', marginBottom: '8px' }}>
                          {ft.specialty} Â· {ft.waitTime}å¾…ã¡ Â· {ft.price}å††/åˆ†
                        </p>
                        
                        <p style={{ fontSize: '14px', color: '#4b5563' }}>{ft.introduction}</p>
                        
                        <div style={{ display: 'flex', gap: '6px', marginTop: '10px', flexWrap: 'wrap' }}>
                          {ft.categories.map(cat => (
                            <span
                              key={cat}
                              style={{
                                padding: '4px 12px',
                                borderRadius: '15px',
                                background: 'rgba(236, 72, 153, 0.1)',
                                color: '#ec4899',
                                fontSize: '12px',
                                fontWeight: '500'
                              }}
                            >
                              {cat}
                            </span>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      };
      
      // ===== ãƒãƒ£ãƒƒãƒˆç”»é¢ =====
      const ChatScreen = () => {
        const messagesEndRef = useRef(null);
        
        useEffect(() => {
          messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages]);
        
        const sendMessage = () => {
          if (inputMessage.trim() === '') return;
          
          const newMessage = {
            id: Date.now(),
            text: inputMessage,
            sender: 'user',
            timestamp: new Date()
          };
          
          setMessages([...messages, newMessage]);
          setInputMessage('');
          
          // ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»
          setPoints(prev => Math.max(0, prev - 50));
          
          // è‡ªå‹•è¿”ä¿¡ï¼ˆãƒ‡ãƒ¢ï¼‰
          setTimeout(() => {
            const reply = {
              id: Date.now() + 1,
              text: 'ãŠæ°—æŒã¡ã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™æœªæ¥ã‚’èª­ã¿è§£ã„ã¦ã„ãã¾ã™ã­...',
              sender: 'fortune',
              timestamp: new Date()
            };
            setMessages(prev => [...prev, reply]);
          }, 2000);
        };
        
        return (
          <div style={{ height: '100vh', display: 'flex', flexDirection: 'column', background: '#f9fafb' }}>
            <div style={{
              background: 'linear-gradient(135deg, #ec4899, #8b5cf6)',
              color: 'white',
              padding: '15px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px',
              boxShadow: '0 2px 10px rgba(139, 92, 246, 0.3)'
            }}>
              <button
                onClick={() => {
                  setScreen('lobby');
                  setMessages([]);
                  setSelectedFortuneTeller(null);
                }}
                style={{
                  background: 'rgba(255, 255, 255, 0.2)',
                  border: 'none',
                  borderRadius: '10px',
                  padding: '8px',
                  cursor: 'pointer',
                  color: 'white'
                }}
              >
                <ChevronLeft style={{ width: '24px', height: '24px' }} />
              </button>
              
              <div style={{ flex: 1 }}>
                <h3 style={{ fontSize: '18px', fontWeight: '600' }}>
                  {selectedFortuneTeller?.name}
                </h3>
                <p style={{ fontSize: '12px', opacity: '0.9' }}>
                  {selectedFortuneTeller?.status === 'online' ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'é‘‘å®šä¸­'}
                </p>
              </div>
              
              <div style={{
                background: 'rgba(255, 255, 255, 0.2)',
                padding: '8px 16px',
                borderRadius: '20px',
                fontSize: '14px'
              }}>
                {points.toLocaleString()}pt
              </div>
            </div>
            
            <div style={{ flex: 1, overflowY: 'auto', padding: '20px' }}>
              {messages.length === 0 && (
                <div style={{
                  textAlign: 'center',
                  padding: '40px',
                  color: '#9ca3af'
                }}>
                  <MessageCircle style={{ width: '48px', height: '48px', margin: '0 auto 16px', opacity: '0.5' }} />
                  <p>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦é‘‘å®šã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†</p>
                  <p style={{ fontSize: '12px', marginTop: '8px' }}>1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: 50pt</p>
                </div>
              )}
              
              {messages.map(msg => (
                <div
                  key={msg.id}
                  className={`chat-bubble ${msg.sender}`}
                  style={{
                    display: 'flex',
                    flexDirection: msg.sender === 'user' ? 'row-reverse' : 'row',
                    alignItems: 'flex-start',
                    gap: '10px',
                    marginBottom: '15px'
                  }}
                >
                  {msg.sender === 'fortune' && (
                    <div style={{
                      width: '40px',
                      height: '40px',
                      background: 'linear-gradient(135deg, #fef3c7, #fde68a)',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '20px'
                    }}>
                      {selectedFortuneTeller?.avatar}
                    </div>
                  )}
                  <div className={`chat-bubble ${msg.sender}`}>
                    {msg.text}
                  </div>
                </div>
              ))}
              <div ref={messagesEndRef} />
            </div>
            
            <div style={{
              background: 'white',
              padding: '15px',
              borderTop: '1px solid #e5e7eb',
              display: 'flex',
              gap: '12px'
            }}>
              <input
                type="text"
                className="input-field"
                style={{ flex: 1, margin: 0 }}
                value={inputMessage}
                onChange={(e) => setInputMessage(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
              />
              <button
                className="btn-primary"
                onClick={sendMessage}
                disabled={inputMessage.trim() === '' || points < 50}
                style={{
                  padding: '12px 24px',
                  opacity: inputMessage.trim() === '' || points < 50 ? 0.5 : 1
                }}
              >
                <Send style={{ width: '20px', height: '20px' }} />
              </button>
            </div>
          </div>
        );
      };
      
      // ===== ãƒã‚¤ãƒ³ãƒˆè³¼å…¥ç”»é¢ =====
      const PurchaseScreen = () => {
        const plans = [
          { id: 1, points: 1000, price: 'Â¥1,000', bonus: 0 },
          { id: 2, points: 3000, price: 'Â¥3,000', bonus: 150, popular: true },
          { id: 3, points: 5000, price: 'Â¥5,000', bonus: 500 },
          { id: 4, points: 10000, price: 'Â¥10,000', bonus: 1500 }
        ];
        
        return (
          <div style={{ minHeight: '100vh', background: '#f9fafb' }}>
            <div style={{
              background: 'linear-gradient(135deg, #ec4899, #8b5cf6)',
              color: 'white',
              padding: '15px',
              display: 'flex',
              alignItems: 'center',
              gap: '12px'
            }}>
              <button
                onClick={() => setScreen('lobby')}
                style={{
                  background: 'rgba(255, 255, 255, 0.2)',
                  border: 'none',
                  borderRadius: '10px',
                  padding: '8px',
                  cursor: 'pointer',
                  color: 'white'
                }}
              >
                <ChevronLeft style={{ width: '24px', height: '24px' }} />
              </button>
              <h2 style={{ fontSize: '20px', fontWeight: '600', margin: 0 }}>ãƒã‚¤ãƒ³ãƒˆè³¼å…¥</h2>
            </div>
            
            <div style={{ padding: '20px' }}>
              <div className="card" style={{ marginBottom: '20px', textAlign: 'center' }}>
                <p style={{ fontSize: '14px', color: '#6b7280', marginBottom: '8px' }}>ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆ</p>
                <p style={{ fontSize: '32px', fontWeight: '700', color: '#ec4899' }}>
                  {points.toLocaleString()}pt
                </p>
              </div>
              
              <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '15px' }}>ãƒ—ãƒ©ãƒ³ã‚’é¸æŠ</h3>
              
              <div style={{ display: 'grid', gap: '15px' }}>
                {plans.map(plan => (
                  <div
                    key={plan.id}
                    className="card"
                    style={{
                      cursor: 'pointer',
                      border: plan.popular ? '2px solid #ec4899' : '2px solid transparent',
                      position: 'relative'
                    }}
                    onClick={() => {
                      setPoints(prev => prev + plan.points + (plan.bonus || 0));
                      setPurchaseHistory([...purchaseHistory, {
                        id: Date.now(),
                        points: plan.points + (plan.bonus || 0),
                        price: plan.price,
                        date: new Date()
                      }]);
                      showToast('ãƒã‚¤ãƒ³ãƒˆã‚’è³¼å…¥ã—ã¾ã—ãŸï¼');
                      setScreen('lobby');
                    }}
                  >
                    {plan.popular && (
                      <div style={{
                        position: 'absolute',
                        top: '-10px',
                        right: '20px',
                        background: 'linear-gradient(135deg, #ec4899, #f472b6)',
                        color: 'white',
                        padding: '4px 12px',
                        borderRadius: '10px',
                        fontSize: '12px',
                        fontWeight: '600'
                      }}>
                        äººæ°—No.1
                      </div>
                    )}
                    
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                      <div>
                        <p style={{ fontSize: '24px', fontWeight: '700', color: '#333' }}>
                          {(plan.points + (plan.bonus || 0)).toLocaleString()}pt
                        </p>
                        {plan.bonus > 0 && (
                          <p style={{ fontSize: '14px', color: '#ec4899', fontWeight: '500' }}>
                            +{plan.bonus}pt ãƒœãƒ¼ãƒŠã‚¹
                          </p>
                        )}
                      </div>
                      <p style={{ fontSize: '20px', fontWeight: '600', color: '#6b7280' }}>
                        {plan.price}
                      </p>
                    </div>
                  </div>
                ))}
              </div>
              
              <div style={{
                marginTop: '30px',
                padding: '20px',
                background: 'rgba(236, 72, 153, 0.05)',
                borderRadius: '15px'
              }}>
                <h4 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '10px', color: '#333' }}>
                  ãŠæ”¯æ‰•ã„æ–¹æ³•
                </h4>
                <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                  <span style={{ padding: '6px 12px', background: 'white', borderRadius: '8px', fontSize: '14px' }}>
                    ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰
                  </span>
                  <span style={{ padding: '6px 12px', background: 'white', borderRadius: '8px', fontSize: '14px' }}>
                    ğŸª ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆ
                  </span>
                  <span style={{ padding: '6px 12px', background: 'white', borderRadius: '8px', fontSize: '14px' }}>
                    ğŸ¦ éŠ€è¡ŒæŒ¯è¾¼
                  </span>
                </div>
              </div>
            </div>
          </div>
        );
      };
      
      // ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆ
      return (
        <div>
          {toast && <div className="toast">{toast}</div>}
          
          {screen === 'login' && <LoginScreen />}
          {screen === 'lobby' && <LobbyScreen />}
          {screen === 'chat' && <ChatScreen />}
          {screen === 'purchase' && <PurchaseScreen />}
        </div>
      );
    }
    
    // ã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<CupidsApp />);
  </script>
</body>
</html>