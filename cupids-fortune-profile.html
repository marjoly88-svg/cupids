// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¡¨ç¤º
function displayProfile(ft) {
    const statusText =
        ft.status === 'available'
            ? 'ã™ãå ãˆã¾ã™'
            : ft.status === 'accepting'
                ? 'é‘‘å®šå—ä»˜ä¸­ï¼ˆ24æ™‚é–“ä»¥å†…ã«è¿”ä¿¡ï¼‰'
                : 'é‘‘å®šåœæ­¢ä¸­';

    const statusClass =
        ft.status === 'available'
            ? 'available'
            : ft.status === 'accepting'
                ? 'accepting'
                : 'stopped';

    const imageUrl = ft.photoURL || ft.profileImageUrl || ft.imageUrl;
    const avatarContent = imageUrl
        ? `<img src="${imageUrl}" class="profile-avatar" />`
        : `<div class="profile-avatar">${(ft.name || 'ï¼Ÿ').charAt(0)}</div>`;

    const tags = ft.specialty
        ? ft.specialty.split(',').map(tag => tag.trim()).filter(Boolean)
        : [];

    // å®Ÿãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ï¼ˆâ˜…ã®ã¿ã‚‚å«ã‚€ï¼‰
    const actualReviewCount =
        typeof ft.actualReviewCount === 'number' && !isNaN(ft.actualReviewCount)
            ? ft.actualReviewCount
            : 0;

    // ç®¡ç†ç”»é¢ã®åŸºæº–ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆï¼‹10ã¨ã‹ï¼‰
    const baseCountRaw =
        typeof ft.baseReviewCount === 'number' && !isNaN(ft.baseReviewCount)
            ? ft.baseReviewCount
            : typeof ft.dummyReviewCount === 'number' && !isNaN(ft.dummyReviewCount)
                ? ft.dummyReviewCount
                : 0;
    const baseReviewCount = Math.max(0, baseCountRaw);

    // è¡¨ç¤ºç”¨ã®é‘‘å®šæ•° = å®Ÿãƒ¬ãƒ“ãƒ¥ãƒ¼ + åŸºæº–å€¤ï¼ˆä¸Šã®ã€Œé‘‘å®šæ•° â—‹ä»¶ã€ã«ä½¿ã†ï¼‰
    const totalReviewCount = actualReviewCount + baseReviewCount;

    // ã‚³ãƒ¡ãƒ³ãƒˆä»˜ããƒ¬ãƒ“ãƒ¥ãƒ¼ä»¶æ•°ï¼ˆã“ã“ã ã‘ã‚’ã€Œãƒ¬ãƒ“ãƒ¥ãƒ¼ (â—¯ä»¶)ã€ã«ä½¿ã†ï¼‰
    const commentReviewCount =
        typeof ft.commentReviewCount === 'number' && !isNaN(ft.commentReviewCount)
            ? ft.commentReviewCount
            : 0;

    // å¹³å‡è©•ä¾¡
    const averageRating =
        typeof ft.averageRating === 'number' && !isNaN(ft.averageRating)
            ? Number(ft.averageRating).toFixed(1)
            : '5.0';

    // 1æ–‡å­—å˜ä¾¡
    const pricePerChar =
        typeof ft.pricePerChar === 'number' && !isNaN(ft.pricePerChar)
            ? ft.pricePerChar
            : typeof ft.price === 'number' && !isNaN(ft.price)
                ? ft.price
                : 10;

    // ãƒãƒ£ãƒƒãƒˆç”»é¢ã«æ¸¡ã™ç”¨
    if (fortuneTellerData) {
        fortuneTellerData.pricePerChar = pricePerChar;
    }

    const html = `
        <div class="profile-header">
            ${avatarContent}
            <div class="profile-name">${ft.name || 'å ã„å¸«'}</div>
            <div class="profile-rating">
                <span class="star">â­</span>
                <span>${averageRating}</span>
                <span>|</span>
                <span>é‘‘å®šæ•° ${totalReviewCount}ä»¶</span>
            </div>
            <div class="profile-status ${statusClass}">${statusText}</div>
            <div class="profile-price">1æ–‡å­— ${pricePerChar}pt</div>
            <a href="https://minamisan.square.site/" target="_blank" class="point-purchase-link">
                ğŸ’³ ãƒã‚¤ãƒ³ãƒˆè³¼å…¥
            </a>

            <!-- â˜… ã“ã“ã‚’è¿½åŠ ï¼šãƒã‚¤ãƒ³ãƒˆè³¼å…¥ãƒœã‚¿ãƒ³ã®ã™ãä¸‹ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼‹ãƒœã‚¿ãƒ³ -->
            <div style="margin-top: 16px;">
                <div class="section-title" style="justify-content: center; margin-bottom: 8px;">
                    ãƒ¬ãƒ“ãƒ¥ãƒ¼ (${commentReviewCount}ä»¶)
                </div>
                <button class="review-button" onclick="openReviewModal()">
                    ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¦‹ã‚‹
                </button>
            </div>
        </div>

        ${tags.length > 0 ? `
        <div class="profile-section">
            <div class="section-title">å¾—æ„åˆ†é‡</div>
            <div class="profile-tags">
                ${tags.map(tag => `<span class="profile-tag">${tag}</span>`).join('')}
            </div>
        </div>
        ` : ''}

        <div class="profile-section">
            <div class="section-title">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</div>
            <div class="profile-description">
                ${ft.profileMessage || 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“'}
            </div>
        </div>
    `;

    document.getElementById('profileContent').innerHTML = html;

    // ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã®çŠ¶æ…‹
    const chatButton = document.getElementById('chatButton');
    if (ft.status === 'stopped') {
        chatButton.disabled = true;
        chatButton.textContent = 'ç¾åœ¨é‘‘å®šã‚’å—ã‘ä»˜ã‘ã¦ã„ã¾ã›ã‚“';
    } else {
        chatButton.disabled = false;
        chatButton.textContent = 'ğŸ’¬ ãƒãƒ£ãƒƒãƒˆã‚’å§‹ã‚ã‚‹';
    }
}
